<!DOCTYPE html  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>_Deployment.au3</title>
<meta name="GENERATOR" content="SciTE - www.Scintilla.org" />
<style type="text/css">
.S0 {
	color: #000000;
	background: #FFFFFF;
}
.S1 {
	font-style: italic;
	color: #319700;
	background: #FFFFFF;
}
.S3 {
	font-style: italic;
	font-weight: bold;
	color: #AC00A9;
	background: #FFFFFF;
}
.S4 {
	font-style: italic;
	font-weight: bold;
	color: #000090;
	background: #FFFFFF;
}
.S5 {
	font-weight: bold;
	color: #0000FF;
	background: #FFFFFF;
}
.S6 {
	font-weight: bold;
	color: #FF33FF;
	background: #FFFFFF;
}
.S7 {
	font-weight: bold;
	color: #9999CC;
	background: #FFFFFF;
}
.S8 {
	font-weight: bold;
	color: #FF0000;
	background: #FFFFFF;
}
.S9 {
	font-weight: bold;
	color: #AA0000;
	background: #FFFFFF;
}
.S10 {
	font-weight: bold;
	color: #FF8800;
	background: #FFFFFF;
}
.S11 {
	font-style: italic;
	color: #F000FF;
	background: #FFFFFF;
}
.S12 {
	font-style: italic;
	color: #A00FF0;
	background: #FFFFFF;
}
span {
	font-family: 'Courier New';
	color: #000000;
	background: #FFFFFF;
	font-size: 11pt;
}
</style>

<meta name="NetsparkQuiltingResult" total-length="68863" removed="0" rules-found="w3123,w3104,w2341,w6769,w7412,w7437,w7438,w5534,w8130,w8131,w5189,w4638,w7495,w4577" />
</head>
<body bgcolor="#FFFFFF">
<span><span class="S1">; Deployment Script - Requires AutoIt3.exe Beta for Gui transparency</span><br />
<br />
<span class="S11">#NoTrayIcon</span><br />
<br />
<span class="S12">#region - Settings</span><br />
<span class="S1">; Gui title. Should not require alteration.</span><br />
<span class="S5">Const</span><span class="S0"> </span><span class="S9">$GUI_TITLE</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'SwInstaller'</span><br />
<span class="S1">; Picture to use as background.</span><br />
<span class="S9">$picture</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\picture.bmp'</span><br />
<span class="S1">; Color of software installing font.(RGB format)</span><br />
<span class="S9">$color_top</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> &nbsp;</span><span class="S3">0xFF8000</span><br />
<span class="S1">; Color of software list font.</span><br />
<span class="S9">$color_side</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0xFFFFFF</span><br />
<span class="S1">; Progress Bar color.</span><br />
<span class="S9">$color_progress</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0x079E05</span><br />
<span class="S1">; Where to search for au3 file types.</span><br />
<span class="S9">$path</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\Software'</span><br />
<span class="S1">; Set Gui as Always On Top. Press Spacebar to toggle on or off.</span><br />
<span class="S9">$setontop</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><br />
<span class="S12">#endregion</span><br />
<br />
<span class="S12">#region - Add Users</span><br />
<span class="S0">_NetUser</span><span class="S8">(</span><span class="S7">'Michael'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><br />
<span class="S12">#endregion</span><br />
<br />
<span class="S12">#region - Create Environment Variables, Paths and Services</span><br />
<span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@SystemDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\SystemFiles'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">EnvSet</span><span class="S8">(</span><span class="S7">'path'</span><span class="S8">,</span><span class="S0"> </span><span class="S4">EnvGet</span><span class="S8">(</span><span class="S7">'path'</span><span class="S8">)</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">';'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@SystemDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\SystemFiles'</span><span class="S8">)</span><br />
<span class="S5">EndIf</span><br />
<span class="S0">_Path</span><span class="S8">(</span><span class="S7">'System'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'%SystemRoot%\SystemFiles'</span><span class="S8">)</span><br />
<span class="S0">_Variable</span><span class="S8">(</span><span class="S7">'User'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Desktop'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'%UserProfile%\Desktop'</span><span class="S8">)</span><br />
<span class="S0">_Variable</span><span class="S8">(</span><span class="S7">'User'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'SendTo'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'%UserProfile%\SendTo'</span><span class="S8">)</span><br />
<span class="S0">_Variable</span><span class="S8">(</span><span class="S7">'User'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Templates'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'%UserProfile%\Templates'</span><span class="S8">)</span><br />
<span class="S0">_Variable</span><span class="S8">(</span><span class="S7">'System'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'AutoIt'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'%SystemRoot%\SystemFiles\AutoIt3.exe'</span><span class="S8">)</span><br />
<span class="S0">_Variable</span><span class="S8">(</span><span class="S7">'System'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'System'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'%SystemRoot%\System32'</span><span class="S8">)</span><br />
<span class="S0">_Variable</span><span class="S8">(</span><span class="S7">'System'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'SystemFiles'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'%SystemRoot%\SystemFiles'</span><span class="S8">)</span><br />
<span class="S0">_ServiceCreate</span><span class="S8">(</span><span class="S7">'User Profile Hive Cleanup'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'UPHClean'</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@SystemDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\uphclean.exe'</span><span class="S8">)</span><br />
<span class="S12">#endregion</span><br />
<br />
<span class="S5">Exit</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _NetUser</span><span class="S8">(</span><span class="S9">$name</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$password</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$groupname</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$autologon</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$groupname</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S9">$groupname</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'Administrators'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$key</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S5">Not</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S4">EnvGet</span><span class="S8">(</span><span class="S7">'AllUsersProfile'</span><span class="S8">)</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\..\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$name</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RunWait</span><span class="S8">(</span><span class="S6">@ComSpec</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' /c '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S8">_</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S7">'Net User '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$name</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$password</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' /add &amp;&amp;'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S8">_</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S7">'Net LocalGroup '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$groupname</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$name</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' /add &amp;'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S8">_</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S7">'Net Accounts /MaxPwAge:UnLimited'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@SW_HIDE</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$autologon</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$key</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon'</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S9">$key</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'DefaultUserName'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$name</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S9">$key</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'DefaultPassword'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$password</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S9">$key</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'AutoAdminLogon'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _ServiceCreate</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$display_name</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$service_name</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$exe_fullpath</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$start</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'auto'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; creates a service from a (compiled service) executable file.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$exe_fullpath</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$display_name</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'displayname= "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$display_name</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'"'</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$exe_fullpath</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'binpath= "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$exe_fullpath</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'"'</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$start</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'start= '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$start</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RunWait</span><span class="S8">(</span><span class="S0"> </span><span class="S6">@SystemDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\sc create '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$service_name</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$exe_fullpath</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$display_name</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$start</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@SW_HIDE</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _SrvAny</span><span class="S8">(</span><span class="S9">$service</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$fullpath</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$hidden</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Adds a program, as a windows service.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Requires $instsrv and $srvany to be assigned, full paths.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; e.g. _SrvAny ( 'ServiceName', 'FullPath_to_the_program' )</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$instsrv</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S6">@WindowsDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\SystemFiles\Instsrv.exe'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$srvany</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S6">@WindowsDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\SystemFiles\SrvAny.exe'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S9">$instsrv</span><span class="S8">)</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S9">$srvany</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RunWait</span><span class="S8">(</span><span class="S9">$instsrv</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$service</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$srvany</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'"'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@SW_HIDE</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$key</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'HKLM\SYSTEM\CurrentControlSet\Services\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$service</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">RegRead</span><span class="S8">(</span><span class="S9">$key</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'DisplayName'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$hidden</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S9">$key</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\Parameters'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'AppParameters'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'/hidden'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S9">$key</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\Parameters'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Application'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$fullpath</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _Path</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$type</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$value</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; adds a folder to permanently become part of the systems path.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$type</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'System'</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$environment</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">ElseIf</span><span class="S0"> </span><span class="S9">$type</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'User'</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$environment</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'HKCU\Environment'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$old</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">RegRead</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$environment</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Path'</span><span class="S8">),</span><span class="S0"> </span><span class="S9">$semicolon</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$old</span><span class="S0"> </span><span class="S8">&lt;&gt;</span><span class="S0"> </span><span class="S7">''</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S9">$semicolon</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">';'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S5">Not</span><span class="S0"> </span><span class="S4">StringInStr</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$old</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$value</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$new</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S9">$old</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$semicolon</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$value</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$environment</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Path'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_Expand_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$new</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S4">EnvUpdate</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _Variable</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$type</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$key</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$value</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; adds a permanent environment variable.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$type</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'System'</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$environment</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">ElseIf</span><span class="S0"> </span><span class="S9">$type</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'User'</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$environment</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'HKCU\Environment'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S5">Not</span><span class="S0"> </span><span class="S4">RegRead</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$environment</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$key</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S0"> </span><span class="S9">$environment</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$key</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_Expand_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$value</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S4">EnvUpdate</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _ToggleOnTop</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Toggle for setting Gui as always on top or not.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Dim</span><span class="S0"> </span><span class="S9">$setontop</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$setontop</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S5">Not</span><span class="S0"> </span><span class="S9">$setontop</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">WinSetOnTop</span><span class="S8">(</span><span class="S9">$GUI_TITLE</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$setontop</span><span class="S8">)</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> OnAutoItExit</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Execute _Prepare.au3, execute all scripts in the .\Software folder,</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; execute _Cleanup.au3, copy _Startup.au3 to Windows directory and</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; add _Startup.au3 information into HKCU/RunOnce key.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">Opt</span><span class="S8">(</span><span class="S7">'RunErrorsFatal'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">Opt</span><span class="S8">(</span><span class="S7">'GUIResizeMode'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">HotKeySet</span><span class="S8">(</span><span class="S7">'</span><span class="S10">{SPACE}</span><span class="S7">'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'_ToggleOnTop'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S5">Const</span><span class="S0"> </span><span class="S9">$GUI_DISABLE</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">128</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S5">Const</span><span class="S0"> </span><span class="S9">$WS_POPUP</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0x80000000</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S5">Const</span><span class="S0"> </span><span class="S9">$PBS_SMOOTH</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S5">Const</span><span class="S0"> </span><span class="S9">$COLOR_WHITE</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0xFFFFFF</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S5">Const</span><span class="S0"> </span><span class="S9">$GUI_BKCOLOR_TRANSPARENT</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S8">-</span><span class="S3">2</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$counter</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$item_side</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$item_top</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$script</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$fontsize</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Dim</span><span class="S0"> </span><span class="S9">$setontop</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$picture</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$color_top</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$color_side</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$color_progress</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Switch</span><span class="S0"> </span><span class="S6">@DesktopWidth</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S3">640</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">1200</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$fontsize</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">8</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S3">1201</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">1601</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$fontsize</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">10</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S3">1602</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">5000</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$fontsize</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">12</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$fontsize</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">8</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndSwitch</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Setup the Gui based background</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICreate</span><span class="S8">(</span><span class="S9">$GUI_TITLE</span><span class="S8">,</span><span class="S0"> </span><span class="S3">640</span><span class="S8">,</span><span class="S0"> </span><span class="S3">480</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$WS_POPUP</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S9">$picture</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlCreatePic</span><span class="S8">(</span><span class="S9">$picture</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S3">640</span><span class="S8">,</span><span class="S0"> </span><span class="S3">480</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlSetState</span><span class="S8">(</span><span class="S5">Default</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$GUI_DISABLE</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$label_top</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">GUICtrlCreateLabel</span><span class="S8">(</span><span class="S9">$item_top</span><span class="S8">,</span><span class="S0"> </span><span class="S3">10</span><span class="S8">,</span><span class="S0"> </span><span class="S3">50</span><span class="S8">,</span><span class="S0"> </span><span class="S3">170</span><span class="S8">,</span><span class="S0"> </span><span class="S3">17</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$label_side</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">GUICtrlCreateLabel</span><span class="S8">(</span><span class="S9">$item_side</span><span class="S8">,</span><span class="S0"> </span><span class="S3">10</span><span class="S8">,</span><span class="S0"> </span><span class="S3">65</span><span class="S8">,</span><span class="S0"> </span><span class="S3">170</span><span class="S8">,</span><span class="S0"> </span><span class="S3">325</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$ctrl_progress</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">GUICtrlCreateProgress</span><span class="S8">(</span><span class="S3">25</span><span class="S8">,</span><span class="S0"> </span><span class="S3">410</span><span class="S8">,</span><span class="S0"> </span><span class="S3">125</span><span class="S8">,</span><span class="S0"> </span><span class="S3">15</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$PBS_SMOOTH</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetColor</span><span class="S8">(</span><span class="S9">$label_top</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$color_top</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetColor</span><span class="S8">(</span><span class="S9">$label_side</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$color_side</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetColor</span><span class="S8">(</span><span class="S9">$ctrl_progress</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$color_progress</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetBkColor</span><span class="S8">(</span><span class="S9">$label_top</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$GUI_BKCOLOR_TRANSPARENT</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetBkColor</span><span class="S8">(</span><span class="S9">$label_side</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$GUI_BKCOLOR_TRANSPARENT</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetBkColor</span><span class="S8">(</span><span class="S9">$ctrl_progress</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$COLOR_WHITE</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetFont</span><span class="S8">(</span><span class="S9">$label_top</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$fontsize</span><span class="S0"> </span><span class="S8">+</span><span class="S3">2</span><span class="S8">,</span><span class="S0"> </span><span class="S3">600</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetFont</span><span class="S8">(</span><span class="S9">$label_side</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$fontsize</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUISetState</span><span class="S8">(</span><span class="S6">@SW_HIDE</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">WinWait</span><span class="S8">(</span><span class="S9">$GUI_TITLE</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">WinSetOnTop</span><span class="S8">(</span><span class="S9">$GUI_TITLE</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$setontop</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">WinMove</span><span class="S8">(</span><span class="S9">$GUI_TITLE</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@DesktopWidth</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@DesktopHeight</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GuiSetState</span><span class="S8">(</span><span class="S6">@SW_SHOW</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUISetBkColor</span><span class="S8">(</span><span class="S4">PixelGetColor</span><span class="S8">(</span><span class="S3">80</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@DesktopHeight</span><span class="S8">/</span><span class="S3">2</span><span class="S8">))</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Start logging.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$tempfile</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">FileOpen</span><span class="S8">(</span><span class="S6">@TempDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\Deployment.log'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">2</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$total</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">TimerInit</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Run the _Prepare.au3 script.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\_Prepare.au3'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$label_top</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Preparing for Software'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">RunWait</span><span class="S8">(</span><span class="S6">@AutoItExe</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\_Prepare.au3"'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Or</span><span class="S0"> </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Error('</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'): _Prepare.au3'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Error: _Prepare.au3 not found in "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'"'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$label_top</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Fill the side list with available script names.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$handle</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">FileFindFirstFile</span><span class="S8">(</span><span class="S9">$path</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\*.au3'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$handle</span><span class="S0"> </span><span class="S8">&lt;&gt;</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">For</span><span class="S0"> </span><span class="S9">$count</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">500</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$data</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">FileFindNextFile</span><span class="S8">(</span><span class="S9">$handle</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">ExitLoop</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$item_side</span><span class="S0"> </span><span class="S8">&amp;=</span><span class="S0"> </span><span class="S6">@LF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S4">StringTrimRight</span><span class="S8">(</span><span class="S4">StringReplace</span><span class="S8">(</span><span class="S9">$data</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'_'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">' '</span><span class="S8">),</span><span class="S0"> </span><span class="S3">4</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Next</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$label_side</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$item_side</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileClose</span><span class="S8">(</span><span class="S9">$handle</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Run all the scripts available.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$handle</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">FileFindFirstFile</span><span class="S8">(</span><span class="S9">$path</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\*.au3'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$handle</span><span class="S0"> </span><span class="S8">&lt;&gt;</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">For</span><span class="S0"> </span><span class="S9">$i</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">500</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$script</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">FileFindNextFile</span><span class="S8">(</span><span class="S9">$handle</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">ExitLoop</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$item_side</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">StringReplace</span><span class="S8">(</span><span class="S9">$item_side</span><span class="S8">,</span><span class="S0"> </span><span class="S4">StringTrimRight</span><span class="S8">(</span><span class="S4">StringReplace</span><span class="S8">(</span><span class="S9">$script</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'_'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">' '</span><span class="S8">),</span><span class="S0"> </span><span class="S3">4</span><span class="S8">)</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@LF</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$label_top</span><span class="S8">,</span><span class="S0"> </span><span class="S4">StringTrimRight</span><span class="S8">(</span><span class="S4">StringReplace</span><span class="S8">(</span><span class="S9">$script</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'_'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">' '</span><span class="S8">),</span><span class="S0"> </span><span class="S3">4</span><span class="S8">))</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$label_side</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$item_side</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$dif</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">TimerInit</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">RunWait</span><span class="S8">(</span><span class="S6">@AutoItExe</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$path</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$script</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'"'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Or</span><span class="S0"> </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$script</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'Error('</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">')'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">ContinueLoop</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$ctrl_progress</span><span class="S8">,</span><span class="S0"> </span><span class="S3">100</span><span class="S8">/</span><span class="S9">$count</span><span class="S8">*</span><span class="S9">$i</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$script</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S4">Round</span><span class="S8">(</span><span class="S4">TimerDiff</span><span class="S8">(</span><span class="S9">$dif</span><span class="S8">)/</span><span class="S3">1000</span><span class="S8">)</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' seconds'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Next</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$item_side</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileClose</span><span class="S8">(</span><span class="S9">$handle</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Run the _Cleanup.au3.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\_Cleanup.au3'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$label_top</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Cleanup in Progress'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">RunWait</span><span class="S8">(</span><span class="S6">@AutoItExe</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\_Cleanup.au3"'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Or</span><span class="S0"> </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Error('</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$exitcode</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'): _Cleanup.au3'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Error: _Cleanup.au3 not found in "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'"'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><span class="S0">&nbsp; &nbsp;</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUICtrlSetData</span><span class="S8">(</span><span class="S9">$label_top</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Copy _Startup.au3 to Windows directory and hide it, then add it to runonce key in registry.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\_Startup.au3'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileCopy</span><span class="S8">(</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\_Startup.au3'</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@WindowsDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S5">Not</span><span class="S0"> </span><span class="S4">FileSetAttrib</span><span class="S8">(</span><span class="S0"> </span><span class="S6">@WindowsDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\_Startup.au3'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'+SHR'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Error: _Startup.au3 FileSetAttrib'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S7">'HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce'</span><span class="S0"> </span><span class="S8">_</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S8">,</span><span class="S0"> </span><span class="S7">'zFirstLogon'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'AutoIt3.exe "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@WindowsDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\_Startup.au3"'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Error: _Startup.au3 RegWrite'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Error: _Startup.au3 FileCopy'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Error: _Startup.au3 not found in "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@ScriptDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'"'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">FileWrite</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@CRLF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'Total time = '</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S4">Round</span><span class="S8">(</span><span class="S4">TimerDiff</span><span class="S8">(</span><span class="S9">$total</span><span class="S8">)/</span><span class="S3">1000</span><span class="S8">/</span><span class="S3">60</span><span class="S8">)</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' minutes'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">FileClose</span><span class="S8">(</span><span class="S9">$tempfile</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUIDelete</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">FileCopy</span><span class="S8">(</span><span class="S6">@AutoItExe</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@WindowsDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\SystemFiles'</span><span class="S8">)</span><br />
<span class="S5">EndFunc</span><br />
<span class="S0"></span></span>
</body>
</html>

<!DOCTYPE html  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>_Daemon_Tools_v4.00.au3</title>
<meta name="GENERATOR" content="SciTE - www.Scintilla.org" />
<style type="text/css">
.S0 {
	color: #000000;
	background: #FFFFFF;
}
.S1 {
	font-style: italic;
	color: #319700;
	background: #FFFFFF;
}
.S3 {
	font-style: italic;
	font-weight: bold;
	color: #AC00A9;
	background: #FFFFFF;
}
.S4 {
	font-style: italic;
	font-weight: bold;
	color: #000090;
	background: #FFFFFF;
}
.S5 {
	font-weight: bold;
	color: #0000FF;
	background: #FFFFFF;
}
.S6 {
	font-weight: bold;
	color: #FF33FF;
	background: #FFFFFF;
}
.S7 {
	font-weight: bold;
	color: #9999CC;
	background: #FFFFFF;
}
.S8 {
	font-weight: bold;
	color: #FF0000;
	background: #FFFFFF;
}
.S9 {
	font-weight: bold;
	color: #AA0000;
	background: #FFFFFF;
}
.S10 {
	font-weight: bold;
	color: #FF8800;
	background: #FFFFFF;
}
.S12 {
	font-style: italic;
	color: #A00FF0;
	background: #FFFFFF;
}
span {
	font-family: 'Courier New';
	color: #000000;
	background: #FFFFFF;
	font-size: 11pt;
}
</style>

<meta name="NetsparkQuiltingResult" total-length="51784" removed="0" rules-found="w3123,w3104,w2341,w4473,w4947,w130,w8997,w8998,w6769,w5189" />
</head>
<body bgcolor="#FFFFFF">
<span><span class="S12">#region - Daemon Tools v4.00 install script - (Automated with WinExists functions)</span><br />
<br />
<span class="S4">Opt</span><span class="S8">(</span><span class="S7">'TrayIconDebug'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><br />
<span class="S4">Opt</span><span class="S8">(</span><span class="S7">'WinDetectHiddenText'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><br />
<span class="S4">Opt</span><span class="S8">(</span><span class="S7">'WinTitleMatchMode'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">4</span><span class="S8">)</span><br />
<br />
<span class="S1">; Installer.</span><br />
<span class="S9">$executable</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'Daemon Tools v4.00.exe'</span><br />
<span class="S1">; Show progess.</span><br />
<span class="S9">$splash</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0</span><br />
<span class="S1">; Default catagory folder in startmenu.</span><br />
<span class="S9">$group</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'DAEMON Tools'</span><br />
<span class="S1">; New catagory to move the default folder into.</span><br />
<span class="S9">$catagory</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><br />
<span class="S1">; Installation folder in Program Files.</span><br />
<span class="S9">$directory</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'DAEMON Tools'</span><br />
<span class="S1">; Allowed time for installation.</span><br />
<span class="S9">$allowed</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">300</span><span class="S0"> </span><span class="S8">*</span><span class="S0"> </span><span class="S3">1000</span><br />
<span class="S1">; Auto or manual reboot. (either choice will runonce the installer at next reboot)</span><br />
<span class="S9">$auto_reboot</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0</span><br />
<br />
<span class="S1">; ** README ""</span><br />
<span class="S1">; Check values above and "Remove shortcuts" section below are correct.</span><br />
<span class="S1">; This is a 2 part install. The 2nd part automatically happens on reboot at HKCU\RunOnce</span><br />
<span class="S1">;&nbsp; &nbsp;which is when the Startup folder is processed and the Desktop is active. This script</span><br />
<span class="S1">;&nbsp; &nbsp;is set to manage both parts of installation automagically. An AutoIt Shutdown() request</span><br />
<span class="S1">;&nbsp; &nbsp;can be added to the end of this script if it is the last item with a Unattended Windows Setup.</span><br />
<span class="S1">; Spyware is unchecked for installation. ;)</span><br />
<br />
<span class="S1">; Run the installer.</span><br />
<span class="S5">If</span><span class="S0"> </span><span class="S9">$auto_reboot</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">StringInStr</span><span class="S8">(</span><span class="S9">$cmdlineraw</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'/postrun'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">WinWait</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Welcome to the DAEMON Tools'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">30</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$pid</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S9">$executable</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$pid</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> _Install</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$pid</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> _Install</span><span class="S8">()</span><br />
<span class="S5">EndIf</span><br />
<span class="S9">$time</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">TimerInit</span><span class="S8">()</span><br />
<span class="S5">Do</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Select</span><span class="S0"> </span><span class="S1">; 1st 3 windows are messageboxes.</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'SPTD setup V1.21'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'This program will install SCSI Pass Through Direct'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlClick</span><span class="S8">(</span><span class="S7">'SPTD setup V1.21'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'This program will install SCSI Pass Through Direct'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Button1'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">Sleep</span><span class="S8">(</span><span class="S3">1000</span><span class="S8">)</span><br />
<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Setup must restart Windows'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _RunOnce</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$auto_reboot</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$choice</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'Button1'</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$choice</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'Button2'</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlClick</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Setup must restart Windows'</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$choice</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">WinWaitClose</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Setup must restart Windows'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">5</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Exit</span><br />
<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'You must reboot after previous operation'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _RunOnce</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlClick</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'You must reboot after previous operation'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Button1'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">; Desktop Reboot after 20 seconds.</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">Sleep</span><span class="S8">(</span><span class="S3">15</span><span class="S8">*</span><span class="S3">1000</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">MsgBox</span><span class="S8">(</span><span class="S3">262144</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'System restart commencing now'</span><span class="S8">,</span><span class="S0"> </span><span class="S3">5</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">Shutdown</span><span class="S8">(</span><span class="S3">2</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Exit</span><br />
<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Welcome to the DAEMON Tools'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlClick</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Welcome to the DAEMON Tools'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Button2'</span><span class="S8">)</span><br />
<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'License Agreement'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlClick</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'License Agreement'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Button2'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Already Installed'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$text</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'Update the automated installation script for uninstall or upgrade support, If required'</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">MsgBox</span><span class="S8">(</span><span class="S3">262144</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$text</span><span class="S8">,</span><span class="S0"> </span><span class="S3">5</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _Abort</span><span class="S8">()</span><br />
<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Choose Components'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlFocus</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Choose Components'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'SysTreeView321'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlSend</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Choose Components'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'SysTreeView321'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'</span><span class="S10">{DOWN}{SPACE}</span><span class="S7">'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlClick</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Choose Components'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Button2'</span><span class="S8">)</span><br />
<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Choose the folder'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlSend</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Choose the folder'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Edit1'</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@ProgramFilesDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$directory</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlClick</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Choose the folder'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Button2'</span><span class="S8">)</span><br />
<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Completing the DAEMON Tools'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlCommand</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Completing the DAEMON Tools'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Button4'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'UnCheck'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ControlClick</span><span class="S8">(</span><span class="S7">'DAEMON Tools 4.00HE'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Completing the DAEMON Tools'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Button2'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">ExitLoop</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndSelect</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">Sleep</span><span class="S8">(</span><span class="S3">1000</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">TimerDiff</span><span class="S8">(</span><span class="S9">$time</span><span class="S8">)</span><span class="S0"> </span><span class="S8">&gt;</span><span class="S0"> </span><span class="S9">$allowed</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _Abort</span><span class="S8">()</span><br />
<span class="S5">Until</span><span class="S0"> </span><span class="S5">Not</span><span class="S0"> </span><span class="S4">ProcessExists</span><span class="S8">(</span><span class="S9">$pid</span><span class="S8">)</span><br />
<br />
<span class="S1">; Remove shortcuts.</span><br />
<span class="S5">If</span><span class="S0"> _MainShortcut</span><span class="S8">(</span><span class="S7">'DAEMON Tools.lnk'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">FileDelete</span><span class="S8">(</span><span class="S7">'Uninstall.lnk'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; _Desktop</span><span class="S8">(</span><span class="S7">'DAEMON Tools.lnk'</span><span class="S8">)</span><br />
<span class="S5">EndIf</span><br />
<br />
<span class="S1">; Delete spyware installer.</span><br />
<span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@ProgramFilesDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$directory</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\SetupDTSB.exe'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">FileDelete</span><span class="S8">(</span><span class="S6">@ProgramFilesDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$directory</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\SetupDTSB.exe'</span><span class="S8">)</span><br />
<span class="S5">EndIf</span><br />
<br />
<span class="S1">; Remove Autorun entry.</span><br />
<span class="S1">;~ RegDelete('HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run', 'DAEMON Tools')</span><br />
<br />
<span class="S12">#endregion</span><br />
<br />
<span class="S5">Exit</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _Install</span><span class="S8">(</span><span class="S9">$path</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'Default'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Run the installer in Default Script directory.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Dim</span><span class="S0"> </span><span class="S9">$splash</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$processblock</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$path</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'Default'</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S9">$path</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S6">@ScriptDir</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">StringRight</span><span class="S8">(</span><span class="S9">$path</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><span class="S0"> </span><span class="S8">&lt;&gt;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S9">$path</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S9">$path</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">StringInStr</span><span class="S8">(</span><span class="S9">$executable</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'\'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S9">$path</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S5">Not</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S9">$path</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$executable</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Exit</span><span class="S8">(</span><span class="S3">1</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$processblock</span><span class="S0"> </span><span class="S8">&lt;&gt;</span><span class="S0"> </span><span class="S7">''</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S4">Call</span><span class="S8">(</span><span class="S7">'_'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'ProcessBlock'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$splash</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _Splash</span><span class="S8">(</span><span class="S7">'Installing:'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S4">StringTrimRight</span><span class="S8">(</span><span class="S4">StringReplace</span><span class="S8">(</span><span class="S6">@ScriptName</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'_'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">' '</span><span class="S8">),</span><span class="S0"> </span><span class="S3">4</span><span class="S8">))</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">StringRight</span><span class="S8">(</span><span class="S9">$executable</span><span class="S8">,</span><span class="S0"> </span><span class="S3">3</span><span class="S8">)</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'msi'</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">Run</span><span class="S8">(</span><span class="S6">@SystemDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\msiexec /i "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$path</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$executable</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'"'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">Run</span><span class="S8">(</span><span class="S9">$path</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$executable</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _Abort</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; close process if exists then exit.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Dim</span><span class="S0"> </span><span class="S9">$pid</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">ProcessExists</span><span class="S8">(</span><span class="S9">$pid</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">ProcessClose</span><span class="S8">(</span><span class="S9">$pid</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Exit</span><span class="S8">(</span><span class="S3">2</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Exit</span><span class="S8">(</span><span class="S3">3</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _Desktop</span><span class="S8">(</span><span class="S9">$shortcut</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Delete a Desktop shortcut.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@DesktopDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$shortcut</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S6">@DesktopDir</span><span class="S8">)</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">FileDelete</span><span class="S8">(</span><span class="S9">$shortcut</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">ElseIf</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@DesktopCommonDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$shortcut</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S6">@DesktopCommonDir</span><span class="S8">)</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">FileDelete</span><span class="S8">(</span><span class="S9">$shortcut</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _MainShortcut</span><span class="S8">(</span><span class="S9">$shortcut</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$rename</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Change working directory to correct StartMenu\Group directory.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Dim</span><span class="S0"> </span><span class="S9">$group</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$catagory</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$splash</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$group</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S3">0</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@ProgramsDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$group</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S6">@ProgramsDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$group</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">ElseIf</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@ProgramsCommonDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$group</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S6">@ProgramsCommonDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$group</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S3">0</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Wait for main shortcut.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$splash</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _Splash</span><span class="S8">(</span><span class="S7">'Waiting for shortcuts'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">For</span><span class="S0"> </span><span class="S9">$i</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">20</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S9">$shortcut</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">ExitLoop</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">Sleep</span><span class="S8">(</span><span class="S3">500</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Next</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$splash</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _Splash</span><span class="S8">(</span><span class="S7">'Cleaning up:'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S4">StringTrimRight</span><span class="S8">(</span><span class="S4">StringReplace</span><span class="S8">(</span><span class="S6">@ScriptName</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'_'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">' '</span><span class="S8">),</span><span class="S0"> </span><span class="S3">4</span><span class="S8">))</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; If catagory not assigned anything, then return.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$catagory</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S3">1</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Move the group folder into the catagory folder.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S7">'..'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">DirCopy</span><span class="S8">(</span><span class="S9">$group</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$catagory</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$group</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">DirRemove</span><span class="S8">(</span><span class="S9">$group</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">; If optional rename parameter is used, then rename the group folder.</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$rename</span><span class="S0"> </span><span class="S8">&lt;&gt;</span><span class="S0"> </span><span class="S7">''</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S9">$catagory</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">DirCopy</span><span class="S8">(</span><span class="S9">$group</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$rename</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">DirRemove</span><span class="S8">(</span><span class="S9">$group</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S9">$rename</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S9">$catagory</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$group</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _QuickLaunch</span><span class="S8">(</span><span class="S9">$shortcut</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Delete a Quicklaunch shortcut.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$subdirs</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'\Microsoft\Internet Explorer\Quick Launch'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@AppDataDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$subdirs</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$shortcut</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S6">@AppDataDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$subdirs</span><span class="S8">)</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">FileDelete</span><span class="S8">(</span><span class="S9">$shortcut</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">ElseIf</span><span class="S0"> </span><span class="S4">FileExists</span><span class="S8">(</span><span class="S6">@AppDataCommonDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$subdirs</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'\'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$shortcut</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">FileChangeDir</span><span class="S8">(</span><span class="S6">@AppDataCommonDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$subdirs</span><span class="S8">)</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">FileDelete</span><span class="S8">(</span><span class="S9">$shortcut</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _Splash</span><span class="S8">(</span><span class="S9">$text</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Shows a small borderless splash message.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Dim</span><span class="S0"> </span><span class="S9">$splash</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$splash</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$text</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">SplashTextOn</span><span class="S8">(</span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$text</span><span class="S8">,</span><span class="S0"> </span><span class="S3">500</span><span class="S8">,</span><span class="S0"> </span><span class="S3">25</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S3">5</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S7">''</span><span class="S8">,</span><span class="S0"> </span><span class="S3">14</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">SplashOff</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _WinClose</span><span class="S8">(</span><span class="S9">$title</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$text</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">''</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Close a window with further attempts.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">For</span><span class="S0"> </span><span class="S9">$i</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">10</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">WinClose</span><span class="S8">(</span><span class="S9">$title</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$text</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S5">Not</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S9">$title</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S3">1</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">Sleep</span><span class="S8">(</span><span class="S3">500</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Next</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> OnAutoItStart</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; A 2nd script instance will exit.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$interpreter</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">StringInStr</span><span class="S8">(</span><span class="S9">$cmdlineraw</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'/dummy'</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Exit</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$interpreter</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">StringTrimRight</span><span class="S8">(</span><span class="S6">@ScriptName</span><span class="S8">,</span><span class="S0"> </span><span class="S3">4</span><span class="S8">)</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">' Script Interpreter'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">WinExists</span><span class="S8">(</span><span class="S9">$interpreter</span><span class="S8">)</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Exit</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S4">AutoItWinSetTitle</span><span class="S8">(</span><span class="S9">$interpreter</span><span class="S8">)</span><br />
<span class="S5">EndFunc</span><br />
<br />
<span class="S5">Func</span><span class="S0"> _RunOnce</span><span class="S8">()</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; Add 2nd part to installation.</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$key</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S7">'HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce'</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@Compiled</span><span class="S0"> </span><span class="S5">Then</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S9">$key</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'_DTools'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'"'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@ScriptFullPath</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'" /postrun'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Else</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">RegWrite</span><span class="S8">(</span><span class="S9">$key</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'_DTools'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'Reg_sz'</span><span class="S8">,</span><span class="S0"> </span><span class="S7">'"'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@AutoItExe</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'" "'</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@ScriptFullPath</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">'" /postrun'</span><span class="S8">)</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br />
<span class="S5">EndFunc</span></span>
</body>
</html>
